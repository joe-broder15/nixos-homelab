# nixos-homelab

Opinionated NixOS configuration for my homelab server. The root module is `configuration.nix`, which pulls in the host's hardware profile and enables the services listed below.

## Supporting files that must exist on the host

- `/etc/nixos/hardware-configuration.nix` – generated by `nixos-generate-config`. The repo expects this file to be present on the system and does not version it.
- `/etc/nixos/wireguard/wg0.conf` – WireGuard interface definition referenced by `networking.wg-quick.interfaces.wg0.configFile`.
- `/etc/nixos/smb-secrets` – Credentials file used by the CIFS share in `fileSystems."/mnt/Library1"`.

Create or copy these files on the machine before rebuilding.

## Services configured here

- NetworkManager for interface management.
- WireGuard server with NAT for clients.
- OpenSSH for remote access.
- qbittorrent headless client.
- Plex Media Server.
- CIFS mount for `//192.168.1.99/Library1`.
- Miscellaneous CLI tooling: `vim`, `wget`, `htop`, `neofetch`, `tree`, `wireguard-tools`, etc.

## Scripts

Two helper scripts live in `scripts/`:

- `scripts/link-configuration.sh` – runs `sudo ln -sf` to replace `/etc/nixos/configuration.nix` with a symlink pointing at the repo copy. Run this after cloning or whenever you relocate the repo.
- `scripts/pull-and-rebuild.sh` – runs `sudo git pull --ff-only` inside the repo and then `sudo nixos-rebuild switch`. Useful for quickly updating the host to match the latest commit.

Ensure both scripts are executable (`chmod +x scripts/*.sh`). They assume the repository is cloned on the target machine and that `sudo` is configured.

## Typical workflow

1. Clone the repository onto the host.
2. Run `./scripts/link-configuration.sh` to point `/etc/nixos/configuration.nix` at the tracked file.
3. Edit or update the configuration as needed.
4. Execute `./scripts/pull-and-rebuild.sh` to fetch the latest changes and rebuild the system.

After each rebuild, verify that services (Plex, qbittorrent, WireGuard, CIFS mount) are healthy.
